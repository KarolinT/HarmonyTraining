---
title: Hands-on training session 3
subtitle: Hui-Walter models with more than two diagnostic tests
date: "`r Sys.Date()`"
fontsize: 12pt
author:
  - Matt Denwood
  - Giles Innocent
  - Sonja Hartnack
theme: metropolis
aspectratio: 43
colortheme: seahorse
header-includes: 
  - \input{preamble}
fig_caption: true
classoption: compress, c
output:
    beamer_presentation:
        pandoc_args: ["-t", "beamer"]
        slide_level: 2
    html_document: default
---

```{r rendering, eval=FALSE, include=FALSE}
# To render this as both html and PDF (beamer) slides run:
rmarkdown::render('Adv3_MultipleTests.Rmd', 'all')
# Or just for html:
rmarkdown::render('Adv3_MultipleTests.Rmd', 'html_document')
```

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Introduction

## Overview

Date/time:

  - 20th February 2020
  - 14.00 - 15.30

Teachers:

  - Matt Denwood (presenter)
  - Giles Innocent
  - Sonja Hartnack


## Recap

Important points from sessions 1 and 2




# Session 3a:  Hui-Walter models for multiple tests with conditional indepdendence

## What exactly is our latent class?

What do we mean by "conditionally independent?"

Example:  three antibody tests

Rabbits and hats 2

## Model specification

Extreme care with multinomial tabulation

Use autohuiwalter!

## Missing data in test results

Use autohuiwalter!

## GLM specification

Combining Hui-Walter part with template.jags

Will likely be included in template.jags in future

## Exercise

Simulate data from 3 or 4 tests and analyse

# Session 3b:  Hui-Walter models for multiple tests with conditional depdendence

## Branching of processes leading to test results

Example:  two antibody tests and one antigen test

Or three antibody tests where one has a different target to the others

## Model specification

Use autohuiwalter!


## Exercise

Simulate data with a dependence between 2 tests

Model assuming conditional independence biases the estimates

Model with conditional depdendence has bigger CI but unbiased


# Session 3c:  Model selection

## Methods of selecting models

DIC works fine for hierarchical normal models

Bayes factors work well if you can count them

WAIC works better for a wide range of models
	
	* Probably won't work for Hui-Walter though due to lack of independent data
	* Could be useful if using the GLM version (untested!)

Models tend to be sensitive to priors

Simulating data and testing that your model recovers the parameters is a good idea

## Discussion and free practical time

